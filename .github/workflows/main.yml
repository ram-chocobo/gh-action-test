name: Deploy master branch

on:
  push:
    branches: [main]
  release:
    types:
      - created

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: make script
        run: |
          cat << EOF > shell.sh
          touch haha.txt
          # pull master branch
          echo "pull master branch"
          cd ${{ secrets.PROJECT_LOCAL_REPO }}
          git checkout master
          git pull origin master
          EOF
          cat shell.sh
      - name: connect to ssh
        shell: bash
        run: |
          mkdir -p ~/.ssh
          ssh-keyscan ${{ secrets.HOST }} >> ~/.ssh/known_hosts
          eval `ssh-agent`
          ssh-add - <<< "${{ secrets.PRIVATE_KEY }}"
          ssh ${{ secrets.USERNAME }}@${{ secrets.HOST }} < shell.sh
      - run: rm shell.sh
      #       - name: build backend
      #         run: |
      #           cd backend
      #           npm i
      #           npm run build
      #           rm -rf node_modules
      #           npm ci
      #           cd ..
      #       - name: build frontend
      #         run: |
      #           cd frontend
      #           npm i
      #           npm run build
      #           rm -rf node_modules
      #           cd ..
      #       - name: restart backend server
      #         run: |
      #           forever stopall
      #           forever start ./backend/dist/app.js
      #       - name: update nginx serve files
      #         run: |
      #           echo 뭐였더라...
