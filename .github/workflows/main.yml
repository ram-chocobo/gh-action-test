name: Deploy master branch

on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: connect to ssh
        run: |
          mkdir -p ~/.ssh
          ssh-keyscan ${{ secrets.HOST }} >> ~/.ssh/known_hosts
          eval `ssh-agent`
          ssh-add - <<< "${{ secrets.PRIVATE_KEY }}"
          ssh -t -t ${{ secrets.USERNAME }}@${{ secrets.HOST }}
          cd ${{ secrets.PROJECT_LOCAL_REPO }}
          git checkout master
          git pull origin master
          logout
      #       - name: build backend
      #         run: |
      #           cd backend
      #           npm i
      #           npm run build
      #           rm -rf node_modules
      #           npm ci
      #           cd ..
      #       - name: build frontend
      #         run: |
      #           cd frontend
      #           npm i
      #           npm run build
      #           rm -rf node_modules
      #           cd ..
      #       - name: restart backend server
      #         run: |
      #           forever stopall
      #           forever start ./backend/dist/app.js
      #       - name: update nginx serve files
      #         run: |
      #           echo 뭐였더라...
